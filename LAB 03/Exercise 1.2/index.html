<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Shopping Cart</title>
</head>

<body>

    <div class="header">
        <h1>My Shop</h1>
        <div class="cart-icon" onclick="toggleCart()">
            ðŸ›’ Cart
            <span class="cart-count" id="cartCount">0</span>
        </div>
    </div>

    <div class="container">
        <h2>Products</h2>
        <div class="products-grid" id="productsGrid"></div>

        <div class="cart-section" id="cartSection" style="display: none;">
            <h2>Shopping Cart</h2>
            <div id="cartItems"></div>
            <div class="cart-total">
                Total: $<span id="cartTotal">0.00</span>
            </div>
        </div>
    </div>

    <script>
        // Product data
        const products = [
            { id: 1, name: 'Laptop', price: 999.99, image: 'ðŸ’»' },
            { id: 2, name: 'Smartphone', price: 699.99, image: 'ðŸ“±' },
            { id: 3, name: 'Headphones', price: 199.99, image: 'ðŸŽ§' },
            { id: 4, name: 'Smartwatch', price: 299.99, image: 'âŒš' }
        ];

        // Cart array
        let cart = [];

        // TODO: Implement functions

        function addToCart(productId) {
            // Find the product type
            const product = products.find(p => p.id == productId);

            // Find the existence of that product in cart
            const cartItem = cart.find(item => item.id == productId);

            // If the cart item is null, push as usual with one, otherwise increment the amount by one
            if (cartItem == null) {
                cart.push({ ...product, quantity: 1 });
            } else {
                cartItem.quantity += 1;
            }

            // Reload the state
            renderCart();
        }

        function removeFromCart(itemId) {
            // TODO: Remove item from cart (by including only non-related objects)
            cart = cart.filter(item => item.id != itemId);

            // Reload the state
            renderCart();
        }

        function updateQuantity(productId, change) {
            // Find the cart item existence
            const cartItem = cart.find(item => item.id == productId);

            if (cartItem.quantity != null) {
                cartItem.quantity += change;

                // If the cart item does not exist (don't buy anymore)
                if (cartItem.quantity <= 0) {
                    removeFromCart(productId);
                }
            }

            // Reload the state
            renderCart();
        }

        function calculateTotal() {
            // TODO: Calculate total price (reduce() : method returns a single value: the function's accumulated result.)
            return cart.reduce((sum, item) => sum += item.price * item.quantity, 0); // Accumulate the sum and round to the digits
        }

        function renderProducts() {
            const grid = document.getElementById("productsGrid");

            // Modify the grid content (Defining new divs)
            grid.innerHTML = products.map(p => `
                <div class = "product-card">
                    <div class = "product-image"> ${p.image} </div>
                    <div class = "product-name"> ${p.name} </div>
                    <div class = "product-price"> ${p.price.toFixed(2)} </div>
                    <button class = "add-to-cart-btn" onclick = "addToCart(${p.id})"> Add to Cart </button>
                </div>
            `).join(``)
        }

        function renderCart() {
            // TODO: Display cart items
            const cartItemsDiv = document.getElementById("cartItems");
            const cartTotal = document.getElementById("cartTotal");
            const cartCount = document.getElementById("cartCount");

            if (cart.length == 0) {
                cartItemsDiv.innerHTML = "Your cart is empty";
                cartTotal.textContent = 0;
                cartCount.textContent = 0;
                return;
            } else {
                // Modify the cart items content
                cartItemsDiv.innerHTML = cart.map(p => `
                    <div class = "cart-product">
                        <div class = "info"> ${p.image} ${p.name} - $${p.price.toFixed(2)} </div> 
                        <div class = "quantity-controls">
                            <button onclick = "updateQuantity(${p.id}, -1)"> - </button> 
                            <span> ${p.quantity}</span> 
                            <button onclick = "updateQuantity(${p.id}, 1)"> + </button>
                            <button onclick = "removeFromCart(${p.id})"> Remove </button>
                        </div>
                    </div>
                `).join("");

                // Update the count of total price and count
                const total = calculateTotal();
                cartTotal.textContent = total.toFixed(2);

                // Update the current items having in cart
                const totalItems = cart.reduce(((sum, item) => sum += item.quantity), 0);
                cartCount.textContent = totalItems;
            }
        }

        function toggleCart() {
            // TODO: Show/hide cart section
            const cartSection = document.getElementById("cartSection");
            cartSection.style.display = cartSection.style.display === "none" ? "block" : "none";
        }

        // Initialize
        renderProducts();
    </script>
</body>

</html>